<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
        <title>Demon Compendium</title>
        <script type="text/javascript">
            async function confirmDelete(e) {
                e.preventDefault();
                var doDelete = window.confirm("Are you sure you want to delete all demons?");
                if (doDelete) {
                    try {
                        var response = await fetch("/api/demons", {
                            method: "delete",
                            headers: {
                                "Content-Type": "application/json"
                            },
                            body: "{}"
                        });
                        if (response.ok) {
                            var data = await response.json();
                            window.location = e.target.href + "?deletedCount=" + data["data"];
                        }
                    } catch (err) {
                        console.log("error: " + err);
                    }
                }
            }

            function addListeners() {
                document.getElementById("deleteAll").addEventListener("click", (e) => { confirmDelete(e); });
            }

            window.onload = addListeners;
        </script>
    </head>
    <body>
        <h1>Shin Megami Dice Game Demon Compendium</h1>
        <p>
            Currently known demons:
            <table>
                <thead>
                    <tr>
                        <th>Demon</th>
                        <th>Level</th>
                        <th>Evolves To</th>
                    </tr>
                </thead>
                <tbody>
                    <% data.forEach((item)=>{ %>
                        <tr>
                            <td><a href="/compendium/demon/<%=item.name%>"><%= item.displayName %></a></td>
                            <td><%=item.level%></td>
                            <td>
                                <%if (item.evolvesTo !== null) {%>
                                    <a href="/compendium/demon/<%=item.evolvesTo%>"><%=item.evolvesToReference.displayName%></a>
                                <%} else {%>
                                    -
                                <%}%>
                            </td>
                        </tr>
                    <% }); %>
                </tbody>
            </table>
        </p>
        <p>
            Upload new data:
            <form action="/compendium/demon/upload" enctype="multipart/form-data" method="POST">
                <input type="file" name="uploadFile">
                <input type="submit" value="Upload">
            </form>                    
        </p>
        <p>
            <a id="deleteAll" href="/compendium/demons/deleteall">Delete all demons</a>
        </p>
        <p>
            <a id="createNew" href="/compendium/demon/new">Create new demon</a>
        </p>
    </body>
</html>
